server:
  port: 8080

spring:
  application:
    name: api-gateway

  cloud:
    compatibility-verifier:
      enabled: false

    gateway:
      # REQUIRED: forward Authorization header to downstream services
      forwarded-headers:
        enabled: true

      default-filters:
        # Keep host + headers intact
        - PreserveHostHeader
        - RemoveRequestHeader=Cookie
        - DedupeResponseHeader=Access-Control-Allow-Origin Access-Control-Allow-Credentials

      routes:

        # -------------------------
        # Auth Service
        # -------------------------
        - id: auth-service
          uri: http://localhost:8081
          predicates:
            - Path=/api/auth/**, /api/me/**

        # -------------------------
        # User Management Service
        # -------------------------
        - id: user-management-service
          uri: http://localhost:8082
          predicates:
            - Path=/api/companies/**,
              /api/admin/**,
              /api/v1/users/**,
              /api/internal/users/**,
              /api/profile/**
          filters:
            #  DO NOT remove Authorization
            - RemoveRequestHeader=Cookie

        # -------------------------
        # Question & Exam Service
        # -------------------------
        - id: question-exam-service
          uri: http://localhost:8084
          predicates:
            - Path=/api/v1/exams/**,
              /api/v1/exam-assignments/**,
              /api/v1/questions/**,
              /api/v1/topics/**,
              /api/v1/employees/**,
              /api/v1/admin/dashboard/**,
              /api/v1/employee/dashboard/**
          filters:
            - RemoveRequestHeader=Cookie

management:
  endpoints:
    web:
      exposure:
        include: health,info

security:
  jwt:
    secret: "myVeryLongAndSecureJwtSecretKeyForApiGatewayThatIsAtLeast32Characters"

logging:
  level:
    org.springframework.cloud.gateway: DEBUG
    reactor.netty.http.client: DEBUG